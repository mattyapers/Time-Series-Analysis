# Installing Packages
```{r}
# library(httr)
# library(jsonlite)
library(pageviews)
library(fpp2)
library(dplyr)
library(lubridate)
library(ggplot2)
```
# Project is about US presidential election, looking at page views and trying to predict web traffic

2008
Barack Obama (Democrat, Winner) and Joe Biden (Running Mate)
John McCain (Republican) and Sarah Palin (Running Mate)

2012
Barack Obama (Democrat, Winner) and Joe Biden (Running Mate)
Mitt Romney (Republican) and Paul Ryan (Running Mate)


2016
Donald Trump (Republican, Winner) and Mike Pence (Running Mate)
Hillary Clinton (Democrat) and Tim Kaine (Running Mate)

-- Due to lack of credible historic data we will not use oldpage views and hence not forecast 2008, 2012, 2016 -- 

2020
Joe Biden (Democrat, Winner) and Kamala Harris (Running Mate)
Donald Trump (Republican) and Mike Pence (Running Mate)

Election-Related Pages
In addition to the candidate pages, consider analyzing traffic to pages related to the elections themselves and key issues that were prominent during those times:

Pages for each election (e.g., "2008 United States presidential election", "2012 United States presidential election", etc.).
Key political and election issues (e.g., "Healthcare reform in the United States", "United States foreign policy", "Climate change policy of the United States", "Immigration policy of Donald Trump", etc.) during the election years.
Political party pages (e.g., "Democratic Party (United States)", "Republican Party (United States)").


```{r}
# old_pageviews looks at data from January 2008 to July 2016
#Description
# This retrieves per-project pageview counts from January 2008 to July 2016. These counts are calculated using the 'legacy' (read: old) model, which overcounts due to its inclusion of web-crawlers and similar automata.


pageview_timestamps(timestamps = Sys.Date(), first = TRUE)
# Basic example
r_pageviews <- article_pageviews()
# 2015-07-01 is the earliest it can access

```
Steps
1. Get pageview data --> convert to time series --> daily average --> eyeball data --> determine type of decomposition
2. Make data stationary -->nsdiffs, ndiffs --> makes ts variance stationary
3. BoxCox Transformation --> keep variance constant (for ARIMA)
4. Decomposition --> if amplitude constant over time --> additive; if increases or decreases --> multiplicative --> split into seasonal + seasonal adj
5. Perform Ljung Box test on residuals --> (observed - fitted both seasonal and seasonal adj) --> if fail
3. 
4. decompose ts --> split into seasonal and seasonal_adj
5. run Ljung_box on residuals (observed - fitted) --> if fail --> move on  to additive --> if fail move on to other models

Steps (ARIMA)
1. Get pageview data --> convert to time series --> daily average --> eyeball data
2. Determine if box.cox transformation is needed --> make variance stationary
3. Either AUTO ARIMA or manual
4. AUTO ARIMA --> determine model
ARIMA
5. nsdiffs --> determine if ARIMA or SARIMA model (D component, D = 0 then ARIMA)
6. ndiffs --> determine order of integration (d component)
7. ACF and PACF --> determines AR component (p, q component find significant lags, determine if exponentially decaying or spike at significant lags or smooth decaying)
8. Model Selection --> look at slides first
# Page Views from January 2008 to July 2016 -- Democratic
```{r}
# 2020
## Democrats

# Obama announced that he would run for president in Feb 2007

obama_pageviews <- article_pageviews(
  article = "Barack_Obama",
  granularity = "monthly",
  start = "2015013000",
  end = "2023123100"
)

head(obama_pageviews)

obama_ts <-ts(data = obama_pageviews$views, start = c(2015,7), frequency = 12)
obama_ts_DA <- obama_ts/monthdays(obama_ts)
autoplot(obama_ts_DA) +
  xlab("Years") + ylab("Views") +
  ggtitle("Average views per day")

# There are significant lags in r1,2,3 and in r19 to 24
obama_lambda <- BoxCox.lambda(obama_ts_DA)
autoplot(BoxCox(obama_ts_DA, lambda = obama_lambda))

autoplot(InvBoxCox(BoxCox(obama_ts_DA, lambda = obama_lambda), lambda = obama_lambda))


# Decompose
autoplot(decompose(x = obama_ts_DA, type = "multiplicative"))

autoplot(stl(obama_ts_DA, s.window="periodic"))




ggAcf(obama_ts_DA)

# Build the 4 benchmark models

## Naive

## Snaive

## Drift

## Mean

# Build complex model
## ARIMA

## S-ARIMA

## ARIMA-X

## VECM

## VAR

# lol test 2
```

```{r}
biden_pageviews <- article_pageviews(
  article = "Joe_Biden",
  granularity = "monthly",
  start = "2016093000",
  end = "2023123100"
)

biden_08_part2_ts <-ts(data = obama_pageviews$views, start = c(2016,9), frequency = 12)
autoplot(biden_08_part2_ts)


democratic_2008_pageviews <- article_pageviews(
  article = "Democratic_Party_(United_States)",
  granularity = "daily",
  start = "2008010100",
  end = "2016080500"
)
democratic_2008_pageviews



```
# Page Views from January 2008 to July 2016 -- Republican
```{r}
## Republicans
John McCain (Republican) and Sarah Palin (Running Mate)

McCain_pageviews <- old_pageviews(
  article = "John_Mccain",
  granularity = "daily",
  start = "2008010100",
  end = "2016080500"
)
McCain_pageviews

Palin_pageviews <- old_pageviews(
  article = "Sarah_Palin",
  granularity = "daily",
  start = "2008010100",
  end = "2016080500"
)
Palin_pageviews

Republican_Party_(United_States)
republican_2008_pageviews <- old_pageviews(
  article = "Republican_Party_(United_States)",
  granularity = "daily",
  start = "2008010100",
  end = "2016080500"
)
republican_2008_pageviews

```

# Other years
```{r}
# 2012

# 2016

# 2020
```